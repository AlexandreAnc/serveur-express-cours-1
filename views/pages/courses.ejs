<!DOCTYPE html>
<html lang="fr">

<head>
<%- include('../layout/head', { title: title }) %>
<style>
    .courses-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
    }

    .courses-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .courses-header h1 {
        font-size: 2.5rem;
        color: #1f2937;
        margin-bottom: 10px;
    }

    .courses-header p {
        color: #6b7280;
        font-size: 1.1rem;
    }

    .courses-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 24px;
        margin-bottom: 40px;
    }

    .course-card {
        background: #ffffff;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
    }

    .course-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    .course-card-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .course-card-header {
        padding: 20px;
        background: white;
    }

    .course-card-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0 0 8px 0;
        color: #1f2937;
    }

    .course-card-instructor {
        font-size: 0.9rem;
        color: #6b7280;
        margin: 0 0 12px 0;
    }

    .course-card-description {
        font-size: 0.95rem;
        color: #6b7280;
        line-height: 1.6;
        margin: 0;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .course-card-body {
        padding: 20px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .course-card-price {
        font-size: 2rem;
        font-weight: 700;
        color: #2563eb;
        margin: 0 0 20px 0;
    }

    .course-card-price::after {
        content: ' ‚Ç¨';
        font-size: 1.2rem;
    }

    .course-card-button {
        width: 100%;
        padding: 12px 24px;
        background: #2563eb;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: auto;
    }

    .course-card-button:hover {
        background: #1d4ed8;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .course-card-button:active {
        transform: translateY(0);
    }

    .loading {
        text-align: center;
        padding: 40px;
        color: #6b7280;
        font-size: 1.1rem;
    }

    .error {
        text-align: center;
        padding: 40px;
        color: #ef4444;
        font-size: 1.1rem;
    }

    .empty-courses {
        text-align: center;
        padding: 60px 20px;
        color: #9ca3af;
    }

    .empty-courses h3 {
        font-size: 1.5rem;
        margin-bottom: 10px;
        color: #6b7280;
    }

    @media (max-width: 768px) {
        .courses-container {
            padding: 0 15px;
        }

        .courses-header h1 {
            font-size: 2rem;
        }

        .courses-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .course-card-header {
            padding: 16px;
        }

        .course-card-body {
            padding: 16px;
        }
    }

    @media (max-width: 480px) {
        .courses-header h1 {
            font-size: 1.75rem;
        }

        .course-card-title {
            font-size: 1.25rem;
        }

        .course-card-price {
            font-size: 1.5rem;
        }
    }
</style>
</head>

<body>
    <%- include('../layout/header') %>

    <main class="container">
        <div class="courses-container">
            <div class="courses-header">
                <h1>üìö Nos cours</h1>
                <p>D√©couvrez notre s√©lection de formations</p>
            </div>

            <div id="courses-container">
                <div class="loading">Chargement des cours...</div>
            </div>
        </div>
    </main>

    <%- include('../layout/footer') %>

    <script>
        // Fonction pour formater le nom de l'instructeur (pr√©nom + NOM)
        function formatInstructorName(name) {
            if (!name) return 'Instructeur inconnu';
            
            var parts = name.trim().split(/\s+/);
            if (parts.length >= 2) {
                // Prendre le premier mot comme pr√©nom et le reste comme nom (en majuscules)
                var prenom = parts[0];
                var nom = parts.slice(1).join(' ').toUpperCase();
                return prenom + ' ' + nom;
            }
            // Si un seul mot, le retourner tel quel
            return name;
        }

        // Fonction pour charger les cours depuis l'API
        async function loadCourses() {
            const container = document.getElementById('courses-container');
            
            try {
                const response = await fetch('/api/courses');
                const result = await response.json();
                
                if (!result.success) {
                    container.innerHTML = '<div class="error">Erreur lors du chargement des cours</div>';
                    return;
                }
                
                const courses = result.data;
                
                if (courses.length === 0) {
                    container.innerHTML = `
                        <div class="empty-courses">
                            <h3>Aucun cours disponible</h3>
                            <p>Les cours seront bient√¥t disponibles.</p>
                        </div>
                    `;
                    return;
                }
                
                // Cr√©er le grid de cartes
                const grid = document.createElement('div');
                grid.className = 'courses-grid';
                
                courses.forEach(function(course, index) {
                    const card = document.createElement('div');
                    card.className = 'course-card';
                    
                    const instructorName = course.instructor 
                        ? formatInstructorName(course.instructor.name)
                        : 'Instructeur inconnu';
                    
                    // G√©n√©rer une image al√©atoire via Picsum Photos (API d'images al√©atoires)
                    // Utiliser l'ID du cours comme seed pour avoir une image coh√©rente
                    const imageSeed = course.id || index;
                    const imageUrl = `https://picsum.photos/seed/${imageSeed}/400/200`;
                    
                    // Description par d√©faut si pas de description dans l'API
                    const description = course.description || 'D√©couvrez ce cours passionnant con√ßu par des experts pour vous accompagner dans votre apprentissage.';
                    
                    card.innerHTML = `
                        <img src="${imageUrl}" alt="${escapeHtml(course.title || 'Cours')}" class="course-card-image" loading="lazy">
                        <div class="course-card-header">
                            <h3 class="course-card-title">${escapeHtml(course.title || 'Sans titre')}</h3>
                            <p class="course-card-instructor">Instructeur : ${escapeHtml(instructorName)}</p>
                            <p class="course-card-description">${escapeHtml(description)}</p>
                        </div>
                        <div class="course-card-body">
                            <div class="course-card-price">${course.price || 0}</div>
                            <button class="course-card-button" onclick="handlePurchase(${course.id}, '${escapeHtml(course.title || '')}')">
                                Acheter
                            </button>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
                
                container.innerHTML = '';
                container.appendChild(grid);
                
            } catch (error) {
                console.error('Erreur lors du chargement des cours:', error);
                container.innerHTML = '<div class="error">Erreur lors du chargement des cours. Veuillez r√©essayer plus tard.</div>';
            }
        }

        // Fonction pour √©chapper le HTML (s√©curit√© XSS)
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Fonction pour g√©rer l'achat
        function handlePurchase(courseId, courseTitle) {
            // TODO: Impl√©menter la logique d'achat
            alert('Achat du cours : ' + courseTitle + ' (ID: ' + courseId + ')');
            // Ici vous pourriez rediriger vers une page de paiement ou ouvrir un modal
        }

        // Charger les cours au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            loadCourses();
        });
    </script>
</body>

</html>

